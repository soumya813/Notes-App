<div class="d-flex flex-column flex-grow-1">
    <div class="row mb-4">
        <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/dashboard" style="text-decoration: none;">Dashboard</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Add Note</li>
                </ol>
            </nav>
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h2 fw-bold">Add Note</h1>
            </div>
        </div>
    </div>

    <div class="card shadow-lg rounded-4 p-4 border-0 flex-grow-1" style="background-color: #ffffff;">
        <% if (typeof error !== 'undefined') { %>
        <div class="alert alert-danger mb-4"><%= error %></div>
        <% } %>

        <form action="/dashboard/add" method="POST" class="d-flex flex-column h-100">
            <div class="form-floating mb-4">
                <input 
                    type="text" 
                    class="form-control" 
                    id="title" 
                    name="title" 
                    placeholder="Note Title" 
                    required 
                    value="<%= typeof formData !== 'undefined' ? formData.title : '' %>" />
                <label for="title">Title</label>
            </div>

            <!-- Quill Editor -->
            <div class="mb-4 flex-grow-1">
                <label for="editor" class="form-label">Content</label>
                <div id="editor" style="height: 400px; background: #fff; border: 1px solid #ccc; border-radius: 8px;">
                </div>
                <!-- Hidden field that stores HTML -->
                <input type="hidden" name="body" id="hiddenBody" 
                       value="<%= typeof formData !== 'undefined' ? formData.body : '' %>">
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg">Add Note</button>
            </div>
        </form>
    </div>
</div>

<!-- Quill.js -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    const quill = new Quill('#editor', { theme: 'snow' });

    // Preload content if editing failed (error with formData)
    const existingContent = document.querySelector("#hiddenBody").value;
    if (existingContent) {
        quill.root.innerHTML = existingContent;
    }

    // Sync content into hidden field before submit
    document.querySelector("form").onsubmit = function() {
        document.querySelector("#hiddenBody").value = quill.root.innerHTML;
    };
</script>
